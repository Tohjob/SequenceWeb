<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <title>Sequence Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; padding: 20px;}
        label { display: block; margin-top: 10px;}
        input[type="text"], select { width: 100%; padding: 6px; box-sizing: border-box; }
        .inline { display: inline-block; margin-right: 10px; }
        .error { color: red; margin: 10px 0; }
        .result { background: #f0f0f0; padding: 10px; margin-top: 15px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Sequence Calculator (เลขคณิต / เรขาคณิต)</h1>
    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}
    <form method="post">
        <label>ชนิดลำดับ:</label>
        <label class="inline"><input type="radio" name="seq_type" value="arithmetic" {% if data.seq_type == "arithmetic" %}checked{% endif %}> เลขคณิต</label>
        <label class="inline"><input type="radio" name="seq_type" value="geometric" {% if data.seq_type == "geometric" %}checked{% endif %}> เรขาคณิต</label>

        <label for="operation">เลือกการทำงาน:</label>
        <select name="operation" id="operation" onchange="showInputs()">
            <option value="รูปทั่วไป (General formula)" {% if data.operation.startswith("รูปทั่วไป") %}selected{% endif %}>รูปทั่วไป (General formula)</option>
            <option value="หา aₙ (Find a_n)" {% if data.operation.startswith("หา aₙ") %}selected{% endif %}>หา aₙ (Find a_n)</option>
            <option value="หา n (Find n)" {% if data.operation.startswith("หา n") %}selected{% endif %}>หา n (Find n)</option>
            <option value="หา d หรือ r จาก a_k และ a_m (Find d/r from two terms)" {% if data.operation.startswith("หา d") or data.operation.startswith("Find d") %}selected{% endif %}>หา d หรือ r จาก a_k และ a_m (Find d/r from two terms)</option>
            <option value="ผลรวม S_n (Sum S_n)" {% if data.operation.startswith("ผลรวม") %}selected{% endif %}>ผลรวม S_n (Sum S_n)</option>
        </select>

        <div id="inputs">
            <div class="input-group" id="row_a1">
                <label>พจน์แรก a1:</label>
                <input type="text" name="a1" value="{{ data.a1 }}">
            </div>
            <div class="input-group" id="row_dr">
                <label id="label_dr">ผลต่างร่วม d / อัตราส่วนร่วม r:</label>
                <input type="text" name="dr" value="{{ data.dr }}">
            </div>
            <div class="input-group" id="row_n">
                <label>พจน์ที่ต้องการ (n):</label>
                <input type="text" name="n" value="{{ data.n }}">
            </div>
            <div class="input-group" id="row_ak">
                <label>พจน์ที่รู้ (a_k):</label>
                <input type="text" name="ak" value="{{ data.ak }}">
            </div>
            <div class="input-group" id="row_k">
                <label>ตำแหน่ง (k):</label>
                <input type="text" name="k" value="{{ data.k }}">
            </div>
            <div class="input-group" id="row_am">
                <label>พจน์ที่รู้อีกตัว (a_m):</label>
                <input type="text" name="am" value="{{ data.am }}">
            </div>
            <div class="input-group" id="row_m">
                <label>ตำแหน่ง (m):</label>
                <input type="text" name="m" value="{{ data.m }}">
            </div>
            <div class="input-group" id="row_an">
                <label>ค่าพจน์ที่รู้ aₙ:</label>
                <input type="text" name="an" value="{{ data.an }}">
            </div>
        </div>

        <button type="submit">คำนวณ</button>
        <button type="button" onclick="window.location='/'">ล้าง</button>
    </form>

    {% if result %}
        <div class="result">
            <h3>ผลลัพธ์:</h3>
            {% for line in result %}
                {{ line }}<br>
            {% endfor %}
        </div>
    {% endif %}

<script>
    function showInputs() {
        const op = document.getElementById("operation").value;
        const seqType = document.querySelector('input[name="seq_type"]:checked').value;
        // ซ่อน input ทั้งหมดก่อน
        const allInputs = ["row_a1", "row_dr", "row_n", "row_ak", "row_k", "row_am", "row_m", "row_an"];
        allInputs.forEach(id => document.getElementById(id).style.display = "none");

        // ปรับ label dr ตามชนิดลำดับ
        document.getElementById("label_dr").textContent = (seqType === "arithmetic") ? "ผลต่างร่วม d:" : "อัตราส่วนร่วม r:";

        if (op.startsWith("รูปทั่วไป")) {
            document.getElementById("row_a1").style.display = "block";
            document.getElementById("row_dr").style.display = "block";
        } else if (op.startsWith("หา aₙ")) {
            document.getElementById("row_a1").style.display = "block";
            document.getElementById("row_dr").style.display = "block";
            document.getElementById("row_n").style.display = "block";
        } else if (op.startsWith("หา n")) {
            document.getElementById("row_a1").style.display = "block";
            document.getElementById("row_dr").style.display = "block";
            document.getElementById("row_an").style.display = "block";
        } else if (op.startsWith("หา d") || op.startsWith("Find d")) {
            document.getElementById("row_ak").style.display = "block";
            document.getElementById("row_k").style.display = "block";
            document.getElementById("row_am").style.display = "block";
            document.getElementById("row_m").style.display = "block";
        } else if (op.startsWith("ผลรวม")) {
            document.getElementById("row_a1").style.display = "block";
            document.getElementById("row_dr").style.display = "block";
            document.getElementById("row_n").style.display = "block";
        } else {
            document.getElementById("row_a1").style.display = "block";
            document.getElementById("row_dr").style.display = "block";
        }
    }

    // เรียกแสดง input ตามค่าที่เลือกตอนโหลดหน้า
    window.onload = showInputs;
    // เปลี่ยนชนิดลำดับแล้วอัพเดต label dr
    document.querySelectorAll('input[name="seq_type"]').forEach(el => el.addEventListener('change', showInputs));
</script>

</body>
</html>